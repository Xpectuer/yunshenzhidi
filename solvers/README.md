# 云深之地求解器
<font color='red'>(注意！由于paddleOCR只支持x86平台，并要求python版本小于等于3.10，苹果M1架构可能不支持，请将脚本运行在x86平台上并安装正确版本的python) </font>

## 云深之地求解器概览

- 程序概括：给定一组线索，检验可行解
- 输入卡牌图片（输入方法见使用方法一节），输出可行的摆法；如无合法的摆法，输出UNSAT

## 使用方法
1. 安装依赖
```
$ pip install -r requirements.txt
```
1. 在solvers文件夹中的imgs文件夹放入线索图片
2. 用windows cmd或者mac的terminal运行主程序
```
$ python main.py
```
  - 程序运行时间与输入图片个数息息相关，如果输入图片过多请耐心等待
  - 运行截图（有解）
  ```
  ...
  Result (27)
GameMap: 
   -1   -1   -1   -1   -1   -1   -1
   -1    2    6    2    1    2   -1
   -1    1    6    6    4    4   -1
   -1    5    6    6    2    4   -1
   -1    4    5    3    3    3   -1
   -1    4    1    5    1    3   -1
   -1   -1   -1   -1   -1   -1   -1

Hermits Layout(0 For Empty Space):
{东北:2|东南:4|西南:3|西北:3}
Budgets Rest: 
[0, 0, 0, 0, 0, 0, 0]

Result (28)
GameMap: 
   -1   -1   -1   -1   -1   -1   -1
   -1    2    6    2    1    2   -1
   -1    1    6    6    4    4   -1
   -1    5    6    6    2    4   -1
   -1    4    5    3    3    3   -1
   -1    4    1    5    1    3   -1
   -1   -1   -1   -1   -1   -1   -1

Hermits Layout(0 For Empty Space):
{东北:2|东南:4|西南:3|西北:3}
Budgets Rest: 
[0, 0, 0, 0, 0, 0, 0]
  ```
  - 运行截图（无解）

```
UNSAT.
```

## 简单理解求解器
### 计算机视觉算法
- 求解器无法直接认识卡牌，因此需要通过一定的数据转化
- 将给定的图片通过计算机视觉算法转化为一定格式的卡片数据结构，例如如下形式：
```
[(1, [[(2, (1, 1)), (6, (0, 0)), (4, (0, 1)), (6, (1, 0))]]), (2, [[(1, (0, 1)), (2, (1, 1)), (4, (1, 0)), (-1, (1, 2)), (-1, (2, 1))]]), (1, [[(6, (0, 1)), (6, (1, 1)), (6, (0, 0)), (6, (1, 0))]]), (0, [[(5, (1, 0)), (1, (0, 0))], [(1, (0, 0)), (4, (1, 0))]], [3, 2], -1), (0, [[(3, (0, 1)), (1, (0, 0))], [(1, (0, 1)), (4, (0, 0))]], [4, 3], -1)]
```
- 将识别出的卡片输入求解器即可求得结果
- 这个过程目前鲁棒性未得到验证，需要进一步的测试

## 数据结构设计
- 内核（Kernel）是线索牌含有的内容，包括地形布局、方向等

## 求解器设计
- 回溯算法
  - 找到隐者牌，列出所有可能的隐者布局
  - 根据这些布局，进行其他线索的填充  
  - 填充剩下的线索
  - 检验填充好的地形是否合格
  

## 目前的问题！！！
- <font color='red'>极目的箭头识别不够鲁棒，请先不要使用极目牌</font>
- <font color='red'>求解器根据需要扩展功能</font>
  
